<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="productMapper">

<!-- 전체 목록 수 조회 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*)
		FROM PRODUCT
		WHERE P_STATUS = 'Y'
	</select>

<!-- 전체 목록 조회 -->
	<select id="selectProductList" resultType="hashmap">
		SELECT *
		FROM PRODUCT
			LEFT JOIN product_image USING(P_NUM)
			LEFT JOIN member USING(M_ID)
			LEFT JOIN member_image USING(M_ID)
		WHERE P_STATUS = 'Y'
		ORDER BY P_NUM DESC
	</select>

<!-- 카테고리별 목록 수 조회 -->
	<select id="getListCountCate" resultType="_int"
		parameterType="string">
		SELECT COUNT(*)
		FROM PRODUCT
		WHERE P_STATUS = 'Y'
			AND P_CATEGORY = #{p_category}
	</select>

<!-- 카테고리별 목록 조회 -->
	<select id="selectProductListCate" resultType="hashmap"
		parameterType="string">
		SELECT *
		FROM PRODUCT
			LEFT JOIN product_image USING(P_NUM)
			LEFT JOIN member USING(M_ID)
			LEFT JOIN member_image USING(M_ID)
		WHERE P_STATUS = 'Y'
			AND P_CATEGORY = #{p_category}
		ORDER BY P_NUM DESC
	</select>
<!-- 상품 디테일 조회 -->
	<select id="selectProduct" parameterType="_int" resultType="Product">
		SELECT * FROM PRODUCT
		WHERE P_STATUS = 'Y' AND P_NUM = #{p_num}
	</select>
	
	<select id="selectProductImg" resultType="list">
		SELECT * FROM PRODUCT_IMAGE WHERE P_NUM = #{p_num}
	</select>

<!-- 상품검색 쿼리 -->
	<select id="search-selectProduct" parameterType="map"
		resultType="hashmap">
		select *
		from psearch_view
		where p_name like '%' || #{search} || '%'
		<if test="subcate != null">
			and p_category = #{subcate}
		</if>
		<if test="price != null">
			<choose>
				<when test='price == "0"'>
					and p_price = 0
				</when>
				<when test='price == "1"'>
					and p_price between 1 and 9999
				</when>
				<when test='price == "2"'>
					and p_price between 10000 and 20000
				</when>
				<when test='price == "3"'>
					and p_price between 20000 and 30000
				</when>
				<when test='price == "4"'>
					and p_price > 30000
				</when>
			</choose>
		</if>
	</select>
	
	<select id="search-getListCount" parameterType="map" resultType="_int">
		select count(*)
    	from psearch_view
    	where p_name like '%' || #{search} || '%'
    	<if test="subcate != null">
        	and p_category = #{subcate}
        </if>
        <if test="price != null">
        	<choose>
        		<when test='price == "0"'>
        			and p_price = 0
        		</when>
        		<when test='price == "1"'>
        			and p_price between 1 and 9999
        		</when>
        		<when test='price == "2"'>
        			and p_price between 10000 and 20000
        		</when>
        		<when test='price == "3"'>
        			and p_price between 20000 and 30000
        		</when>
        		<when test='price == "4"'>
        			and p_price > 30000
        		</when>
        	</choose>
        </if>
	</select>
	
	<!-- home.jsp에 최신상품 조회 -->
	<select id="selectNewProductList" resultType="hashmap">
		<![CDATA[
		select rownum, pv.*
		from ( select p.* from psearch_view p order by p.p_num desc) pv
        where rownum <= 5]]>
	</select>
</mapper>
